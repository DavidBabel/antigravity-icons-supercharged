#!/bin/sh
# Bump minor version (creates commit and tag)
# The [skip ci] in the message prevents this commit from triggering a CI loop,
# but the tag push will still trigger the publish workflow.

echo "ðŸš€ Bumping version and integrating into previous commit..."

# 1. Bump version in package.json (no new commit, no tag yet)
npm version minor --no-git-tag-version

# 2. Amend the last commit to include this change
git commit --amend --no-edit --all

# 3. Create the tag on this new SHA
VERSION=$(node -p "require('./package.json').version")
git tag "v$VERSION"

echo "âœ… Version bumped to $VERSION and tag v$VERSION created on amended commit."

# 4. Push correctly (skip hooks to avoid loop, use force because SHA changed)
echo "ðŸ“¤ Pushing amended commit and tags..."
git push origin HEAD --force --follow-tags --no-verify

# 5. Cancel original push (it's obsolete because SHA changed)
echo "ðŸ›‘ Cancelling original push (replaced by new push)."
exit 1
